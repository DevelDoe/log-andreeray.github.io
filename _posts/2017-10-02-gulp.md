---
date: '2017-10-02 16:02 +0200'
published: true
title: Gulp
---
*Den här artikeln är en förkortning av orginal artikeln [Gulp for Beginners](https://css-tricks.com/gulp-for-beginners) som finns på css-tricks.com*


Gulp är ett "byggverktyg" som ofta används för att göra front-end uppgifter som:

* Starta en webbserver
* Ladda om webbläsare automatiskt när en fil sparas
* Gå över förprocessorer som Sass eller LESS
* Optimera tillgångar som CSS, JS och bilder

---

## Install

```
sudo npm install gulp -g
npm init
npm install gulp --save-dev
```

---

## file Structure

Gulp är flexibel nog att arbeta utifrån vilken mappstruktur som helst. Du måste bara förstå dem innan du anpassar det till ditt projekt.

```
|- src/
    |-css
    |-fonts
    |-img
    |-js
    |-index.html
|-build
|-gulpfile.js
|-node-modules
|-package.json
```

I den här strukturen använder vi src-mappen för utvecklingsändamål, medan build-mappen används för att innehålla de optimerade filerna för produktion. Eftersom src används för utvecklingsändamål placeras all vår kod i src. Vi måste behålla den här mappstrukturen när vi arbetar med våra Gulp-konfigurationer. 

---

## Writing Your First Gulp Task

Det första steget att för att använda Gulp är att använda common.js syntaxens `require`  i configurations filen gulpfile.

```js
var gulp = require('gulp');
```

`require` uttalandet berättar för Node att titta in i mappen node_modules för ett paket som heter Gulp. När paketet hittats, tilldelar vi innehållet till variabeln.

Vi kan nu skriva en gulp-uppgift med denna gulp-variabel. Den grundläggande syntaxen för en gulp-uppgift är:

```js
gulp.task('task-name', function() {
    // callback
});
```

`task-name` hänvisar till namnet på uppgiften vilket används när du vill köra en uppgift i Gulp. 

Du kan också köra samma uppgift i kommandoraden genom att skriva ` gulp task-name`.

För att testa det, låt oss skapa en hej uppgift som säger Hello Gulp !.

```js
gulp.task('hello-gulp', function() {
    console.log('Hello Gulp');
});
```

Vi kan köra den här uppgiften med gulp hej på kommandoraden `gulp hello-gulp`.

Här är hur en riktig uppgift kan se ut:

```js
var gulp = require('gulp');

gulp.task('atask', function() {
    return gulp.src('/src/css*')
        .pipe(aGulpPlugin())
        .pipe(gulp.dest('/build'))
});
```


Som du kan se, tar en riktig uppgift två extra gulp-metoder `gulp.src` och `gulp.dest`.

`gulp.src` berättar Gulp-uppgiften vilka filer som ska användas för uppgiften, medan `gulp.dest` berättar vart Gulp ska mata ut filerna när uppgiften är klar.

---

## Example of a Gulp task - Preprocessing with Gulp

Vi kan kompilera Sass till CSS i Gulp med hjälp av ett plugin som heter gulp-sass.

Du kan installera gulp-sass i ditt projekt genom att använda kommandot npm installerat som vi gjorde för gulp.

```bash
npm install gulp-sass --save-dev
```

Vi måste `require` gulp-sass från mappen node_modules precis som vi gjorde med gulp innan vi kan använda plugin.

```js
var gulp = require('gulp');
// Requires the gulp-sass plugin
var sass = require('gulp-sass');
```

Vi kan använda gulp-sass genom att ersätta `aGulpPlugin()` med `sass()`.

Eftersom uppgiften är avsedd att sammanställa Sass i CSS, låt oss namnge det sass.

```js
gulp.task('sass', function(){
  return gulp.src('source-files')
    .pipe(sass()) // Using gulp-sass
    .pipe(gulp.dest('destination'))
});
```

Vi måste tillhandahålla sass-uppgiften med källfiler och en destination för att uppgiften ska fungera, så låt oss skapa en styles.scss-fil i src/css-mappen.

Den här filen läggs till i sass-uppgiften i gulp.src.

Vi vill exportera den slutliga styles.css-filen till mappen `build/default.css`, vilket skulle vara destinationen för gulp.dest.

```js
gulp.task('sass', function(){
  return gulp.src('src/css/styles.scss')
    .pipe(sass()) // Converts Sass to CSS with gulp-sass
    .pipe(gulp.dest('build/css/default.css'))
});
```

Vi vill prova att sass-uppgiften fungerar som vi vill ha det. För att göra det kan vi lägga till en Sass-funktion inom styles.scss.

```js
// styles.scss
.testing {
  width: percentage(5/7);
}
```

Om du kör gulp sass i kommandoraden, borde du nu kunna se att en styles.css-fil skapades i app / css. Dessutom har den koden där procentandel (5/7) utvärderades till 71,42857%.

```css
/* styles.css */
.testing {
  width: 71.42857%; 
}
```

Så vet vi att sass-uppgiften fungerar!

Sometimes we need the ability to compile more than one `.scss` file into CSS at the same. We can do so with the help of Node globs.

**Notera: Gulp-sass använder `LibSass` för att konvertera Sass till CSS. Det är mycket snabbare än Ruby-baserad. Om du vill kan du fortfarande använda Ruby-metoder med Gulp genom att använda `gulp-ruby-sass` eller `gulp-kcompass` i stället.**

---

### Globbing in Node

Globs matchar mönster för filer som låter dig lägga till mer än en fil i `gulp.src`. Det är som vanligt uttryck, men specifikt för filvägar.

När du använder en glob kontrollerar datorn filnamn och sökvägar för det angivna mönstret. Om mönstret existerar matchas en fil.

De flesta arbetsflöden med Gulp tenderar att bara kräva 4 olika globbing mönster:

* `/*.scss` - Mönstret är ett jokertecken som matchar alla mönster i den aktuella katalogen. I det här fallet matchar vi alla filer som slutar med `.scss` i rotmappen (projekt).
* `**/*.scss` - Matchar alla filer som slutar med `.scss` i rotmappen och eventuella barnkataloger.
* `!not-me.css` - ! indikerar att Gulp bör utesluta mönstret från dess matchningar. I detta fall skulle `inte-me.scss` uteslutas från matchen.
* `*.+(scss|sass)` -  Plus `+` och parenteserna `()` tillåter Gulp att matcha flera mönster, med olika mönster separerade av röret `|` karaktär. I detta fall matchar Gulp alla filer som slutar med .scss eller .sass i rotmappen.

Eftersom vi vet om globbing nu kan vi ersätta `src/css/styles.scss` med ett `scss/**/*.scss` mönster som matchar alla filer med en .scss-förlängning i `src/scss` eller en barnkatalog.

```js
gulp.task('sass', function() {
  return gulp.src('app/scss/**/*.scss') // Gets all files ending with .scss in app/scss and children dirs
    .pipe(sass())
    .pipe(gulp.dest('app/css'))
})
```

Alla andra Sass-filer som finns i `src/scss` kommer automatiskt att inkluderas i sass-uppgiften med den här ändringen. Om du lägger till en print.scss-fil i projektet ser du att `print.css` kommer att genereras i build/css.

---

## Watching Sass files for changes

Gulp ger oss en watch metod som kontrollerar om en fil sparades. Syntaxen för watch metoden är:

```js
// Gulp watch syntax
gulp.watch('files-to-watch', ['tasks', 'to', 'run']); 
```

Om vi vill titta på alla Sass-filer och köra sass-uppgiften närhelst en Sass-fil sparas måste vi bara ersätta filer-till-titta med `src/css/**/*.scss`  och `['tasks' att ',' springa ']` med `[' sass ']`

```js
// Gulp watch syntax
gulp.watch('app/css/**/*.scss', ['sass']);
```

Ofta vill vi dock övervaka mer än en typ av fil på en gång. För att göra det kan vi gruppera flera watch processer i en enda watch uppgift.

```js
gulp.task('watch', function(){
  gulp.watch('app/scss/**/*.scss', ['sass']); 
  // Other watchers
})
```

Om du körde kommandot `gulp watch` nu ser du att Gulp börjar övervaka direkt Och att den automatiskt kör sass-uppgiften när du sparar en .scss-fil.


---

## Optimizing CSS and JavaScript files

Utvecklare har två uppgifter att utföra när vi försöker optimera CSS och JavaScript-filer för produktion: minifiering och sammanlänkning.

Ett problem utvecklare står inför när du automatiserar processen är att det är svårt att sammanfoga dina skript i rätt ordning.

Säg att vi har inkluderat 3 skriptkoder i index.html.

```html
<body>
  <!-- other stuff -->
  <script src="js/lib/a-library.js"></script>
  <script src="js/lib/another-library.js"></script>
  <script src="js/main.js"></script>
</body>
```

Dessa skript finns i två olika kataloger. Det blir svårt att sammanfatta dem med traditionella plugins som `gulp-concatenate`.

Lyckligtvis finns det ett användbart Gulp-plugin, `gulp-useref` som löser detta problem.

Gulp-useref konkatinerar ett antal CSS- och JavaScript-filer i en enda fil genom att leta efter en kommentar som börjar med "<! - build:" och slutar med "<! - endbuild ->". Dess syntax är:

```html
<!-- build:<type> <path> -->
... HTML Markup, list of script / link tags.
<!-- endbuild -->
```

`<typ>` kan antingen vara `js`, `css` eller `remov`. Det är bäst att ange typ för den typ av fil som du försöker sammanfoga.

Om du anger typen `remove` tar Gulp bort hela byggblocket utan att skapa en fil. 

`<path>` hänvisar här till den genererade filens målväg. 

Vi vill att den compilerade JavaScript-filen ska genereras i js-mappen, till main.min.js. Därför skulle markeringen vara:

```html
<!--build:js js/main.min.js -->
<script src="js/lib/a-library.js"></script>
<script src="js/lib/another-library.js"></script>
<script src="js/main.js"></script>
<!-- endbuild -->
```

Vi måste installera pluginet anropa det `require` i gulpfilen.

```bash
npm install gulp-useref --save-dev
```

```js
var useref = require('gulp-useref');
```
Upprättandet av task uppgiften liknar de andra uppgifter som vi gjort hittills:

```js
gulp.task('useref', function(){
  return gulp.src('app/*.html')
    .pipe(useref())
    .pipe(gulp.dest('dist'))
});
```

