<p><strong>upload.html</strong></p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;title&gt;</span>File Uploader - coligo.io<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">'https://fonts.googleapis.com/css?family=Raleway'</span> <span class="na">rel=</span><span class="s">'stylesheet'</span> <span class="na">type=</span><span class="s">'text/css'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"css/styles.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-xs-12"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-default"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"glyphicon glyphicon-cloud-upload"</span><span class="nt">&gt;&lt;/span&gt;</span>
            <span class="nt">&lt;h2&gt;</span>File Uploader<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;h4&gt;</span>coligo.io<span class="nt">&lt;/h4&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"progress"</span><span class="nt">&gt;</span>
              <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"progress-bar"</span> <span class="na">role=</span><span class="s">"progressbar"</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-lg upload-btn"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>Upload File<span class="nt">&lt;/button&gt;</span>
          <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"upload-input"</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"uploads[]"</span> <span class="na">multiple=</span><span class="s">"multiple"</span><span class="nt">&gt;&lt;/br&gt;</span>

  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-2.2.0.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"javascripts/upload.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p><strong>upload.css</strong></p>

<div class="language-css highlighter-rouge"><pre class="highlight"><code><span class="nc">.btn</span><span class="nd">:focus</span><span class="o">,</span> <span class="nc">.upload-btn</span><span class="nd">:focus</span><span class="p">{</span>
  <span class="nl">outline</span><span class="p">:</span> <span class="m">0</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">html</span><span class="o">,</span>
<span class="nt">body</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#4791D2</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Raleway'</span><span class="p">,</span> <span class="nb">sans-serif</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.row</span> <span class="p">{</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">80px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.upload-btn</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#ffffff</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#F89406</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.upload-btn</span><span class="nd">:hover</span><span class="o">,</span>
<span class="nc">.upload-btn</span><span class="nd">:focus</span><span class="o">,</span>
<span class="nc">.upload-btn</span><span class="nd">:active</span><span class="o">,</span>
<span class="nc">.upload-btn.active</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#ffffff</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#FA8900</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h4</span> <span class="p">{</span>
  <span class="nl">padding-bottom</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#B8BDC1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.glyphicon</span> <span class="p">{</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">5em</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#9CA3A9</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="nl">margin-top</span><span class="p">:</span> <span class="m">15px</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#68757E</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.panel</span> <span class="p">{</span>
  <span class="nl">padding-top</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
  <span class="nl">padding-bottom</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#upload-input</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@media</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">768px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">.main-container</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">@media</span> <span class="p">(</span><span class="n">min-width</span><span class="p">:</span> <span class="m">992px</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">.container</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">450px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><strong>upload.js</strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">$</span><span class="p">(</span><span class="s1">'.upload-btn'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'#upload-input'</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'.progress-bar'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">'0%'</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'.progress-bar'</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="s1">'0%'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">$</span><span class="p">(</span><span class="s1">'#upload-input'</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>

  <span class="kd">var</span> <span class="nx">files</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">files</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">files</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">// create a FormData object which will be sent as the data payload in the</span>
    <span class="c1">// AJAX request</span>
    <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>

    <span class="c1">// loop through all the selected files and add them to the formData object</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

      <span class="c1">// add the files to formData object for the data payload</span>
      <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'uploads[]'</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="na">url</span><span class="p">:</span> <span class="s1">'/upload'</span><span class="p">,</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>
      <span class="na">processData</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">contentType</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'upload successful!\n'</span> <span class="o">+</span> <span class="nx">data</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="na">xhr</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// create an XMLHttpRequest</span>
        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>

        <span class="c1">// listen to the 'progress' event</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'progress'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// calculate the percentage of upload completed</span>
            <span class="kd">var</span> <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
            <span class="nx">percentComplete</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">percentComplete</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>

            <span class="c1">// update the Bootstrap progress bar with the new percentage</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'.progress-bar'</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">percentComplete</span> <span class="o">+</span> <span class="s1">'%'</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'.progress-bar'</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">percentComplete</span> <span class="o">+</span> <span class="s1">'%'</span><span class="p">);</span>

            <span class="c1">// once the upload reaches 100%, set the progress bar text to done</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">percentComplete</span> <span class="o">===</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">$</span><span class="p">(</span><span class="s1">'.progress-bar'</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">'Done'</span><span class="p">);</span>
            <span class="p">}</span>

          <span class="p">}</span>

        <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">xhr</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>

  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
</div>

<p><strong>server.js</strong></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">formidable</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'formidable'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'public'</span><span class="p">)));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'views/index.html'</span><span class="p">));</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/upload'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>

  <span class="c1">// create an incoming form object</span>
  <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">formidable</span><span class="p">.</span><span class="nx">IncomingForm</span><span class="p">();</span>

  <span class="c1">// specify that we want to allow the user to upload multiple files in a single request</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">multiples</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="c1">// store all uploads in the /uploads directory</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">uploadDir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'/uploads'</span><span class="p">);</span>

  <span class="c1">// every time a file has been uploaded successfully,</span>
  <span class="c1">// rename it to it's orignal name</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'file'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">uploadDir</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">));</span>
  <span class="p">});</span>

  <span class="c1">// log any errors that occur</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'An error has occured: \n'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="c1">// once all the files have been uploaded, send a response to the client</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">'success'</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="c1">// parse the incoming request containing the form data</span>
  <span class="nx">form</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>

<span class="p">});</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Server listening on port 3000'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
</div>
